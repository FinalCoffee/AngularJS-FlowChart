<svg 
  class="draggable-container"
  width="100%" 
  height="100%" 
  xmlns="http://www.w3.org/2000/svg"
>
  <defs>
    <linearGradient 
      spreadMethod="pad" 
      y2="0" 
      x2="0" 
      y1="1" 
      x1="0" 
      id="nodeBackgroundGradient"
      >
      <stop 
        offset="0" 
        stop-opacity="0.99609" 
        stop-color="#56aaff"
        />
        <stop 
        offset="0.63934" 
        stop-opacity="0.99219" 
        stop-color="#d0d0e5"
        />
    </linearGradient>
  </defs>
  <g
    ng-repeat="node in chart.nodes"
    ng-mousedown="nodeMouseDown($event, $index)"
    ng-attr-transform="translate({{node.x}}, {{node.y}})"
    >
    <rect 
      class="node-rect"
      ry="10" 
      rx="10" 
      x="80" 
      y="50" 
      width="200" 
      height="150" 
      >
    </rect>

    <g
      ng-repeat="connector in node.inputConnectors"
      ng-mousedown="inputConnectorMouseDown($event, node, connector, $index)"
      >
      <text
        ng-attr-x="{{computeLocalInputConnectorX($index) + 20}}"
        ng-attr-y="{{computeLocalInputConnectorY($index)}}"
        alignment-baseline="middle"
        >
        {{connector.name}}
      </text>
      <circle       
        class="connector-circle"      
        r="10" 
        ng-attr-cx="{{computeLocalInputConnectorX($index)}}"
        ng-attr-cy="{{computeLocalInputConnectorY($index)}}"
        />
    </g>

    <g
      ng-repeat="connector in node.outputConnectors"
      >
      <text
        ng-attr-y="{{100 + ($index * 36.5)}}" 
        x="260"
        text-anchor="end"
        alignment-baseline="middle"
        >
        {{connector.name}}
      </text>
      <circle             
        class="connector-circle"      
        r="10" 
        ng-attr-cy="{{100 + ($index * 36.5)}}" 
        cx="280" 
        />
    </g>

    <text 
      text-anchor="middle" 
      font-family="serif" 
      font-size="24" 
      y="80" 
      x="183" 
      >
      {{node.title}}
    </text>
  </g>

  <!-- Represents the connection being dragged out. 
  <line
    class="dragging-connection"
    ng-if="draggingConnection"
    ng-attr-x1="{{draggingConnectorPos.x}}"
    ng-attr-y1="{{draggingConnectorPos.y}}"
    ng-attr-x2="{{dragPoint.x}}"
    ng-attr-y2="{{dragPoint.y}}"
    >
  </line>
    ng-if="draggingConnection"
  -->

  <path
    class="dragging-connection"
    ng-attr-d="M {{draggingConnectorPos.x}}, {{draggingConnectorPos.y}}
               C {{draggingConnectorPos.x-tangentOffset}}, {{draggingConnectorPos.y}}
                 {{dragPoint.x+tangentOffset}}, {{dragPoint.y}}
                 {{dragPoint.x}}, {{dragPoint.y}}"
    fill="transparent"
    >
  </path>

  <circle
      r="5" 
      ng-attr-cx="{{draggingConnectorPos.x-tangentOffset}}" 
      ng-attr-cy="{{draggingConnectorPos.y}}" 
      stroke="red"
      stroke-width="1"
      fill="transparent"
      >
  </circle>

  <circle
      r="5" 
      ng-attr-cx="{{dragPoint.x+tangentOffset}}" 
      ng-attr-cy="{{dragPoint.y}}" 
      stroke="blue"
      stroke-width="1"
      fill="transparent"
      >
  </circle>
  

</svg>

